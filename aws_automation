pipeline {
    agent any

    parameters {
        string(name: 'AWS_REGION', defaultValue: 'us-east-1', description: 'AWS Region to list S3 buckets')
    }

    stages {
        stage('List S3 Buckets') {
            steps {
                script {
                    try {
                        echo "Listing S3 buckets..."
                        
                        // List all S3 buckets (globally)
                        def result = sh(script: "aws s3 ls", returnStdout: true).trim()

                        // Check if the result has content (i.e., S3 buckets)
                        if (result) {
                            echo "S3 Buckets in your account:"
                            echo result
                        } else {
                            echo "No S3 buckets found."
                        }
                    } catch (Exception e) {
                        echo "Error listing S3 buckets: ${e.getMessage()}"
                        currentBuild.result = 'FAILURE'
                    }
                }
            }
        }
    }

    post {
        failure {
            echo 'The pipeline failed!'
        }
        success {
            echo 'S3 bucket listing completed successfully.'
        }
    }
}
